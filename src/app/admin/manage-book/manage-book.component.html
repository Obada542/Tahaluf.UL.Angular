<div class="col-lg-12 grid-margin stretch-card">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Manage Books</h4>
      <button class=" card-description btn btn-primary " (click)="openCreateDialog()" style="color: #fff;"> Add
        Book</button>
      <table class="table table-responsive table-striped">
        <thead>
          <tr>
            <th> Image </th>
            <th> Book Name </th>
            <th> Author </th>
            <th> Price </th>
            <th> Quantity </th>
            <th> Library </th>
            <th> Category </th>
            <th> Time sold </th>
            <th> Action </th>

          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of book.books">
            <td class="py-1">
              <img src="../../../assets/Images/{{book.image}}" alt="image" />
            </td>
            <td> {{book.book_Name}} </td>
            <td> {{book.author}} </td>
            <td> {{book.price}} </td>
            <td> {{book.quantity}} </td>
            <td> {{book.library_Id}} </td>
            <td> {{book.category}} </td>
            <td> {{book.nosold}} </td>
            <td>
              <a class="text-danger" (click)="openDeleteDialog(book.id)">Delete</a>
              |
              <a class="link" (click)="openUpdateDialog(book)">Update</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<ng-template #createNewBook>
  <div class="col-12 dialog">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Create New Book <button mat-button mat-dialog-close class="btn"
            style="color: red; float: right; font-size: 25px;">X</button></h4>
        <form class="form-sample" [formGroup]="createbook">
          <p class="card-description"> Book info </p>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Book Name</label>
                <div class="col-sm-8">
                  <input type="text " class="form-control" matInput formControlName="book_Name" placeholder="Book name">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['book_Name'].hasError('required') && createbook.controls['book_Name'].touched">
                    Book name is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Author Name</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" matInput formControlName="author" placeholder="author name">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['author'].hasError('required') && createbook.controls['author'].touched">
                    Author name is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Price</label>
                <div class="col-sm-8">
                  <input type="number" min="1" class="form-control" matInput formControlName="price" value="1">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['price'].hasError('required') && createbook.controls['price'].touched">
                    Price is <strong class="text-danger">required</strong>
                  </mat-error>
                  <mat-error class="text-danger" *ngIf="createbook.controls['price'].hasError('min') ">
                    Price must be more than 0
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Quantity</label>
                <div class="col-sm-8">
                  <input type="number" min="1" class="form-control" matInput formControlName="quantity" value="1">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['quantity'].hasError('required') && createbook.controls['quantity'].touched">
                    Quantity is <strong class="text-danger">required</strong>
                  </mat-error>
                  <mat-error class="text-danger" *ngIf="createbook.controls['quantity'].hasError('min') ">
                    Quantity must be more than 0
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Categoryies</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" matInput formControlName="category">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['category'].hasError('required') && createbook.controls['category'].touched">
                    Category is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
                <small>*For more than one category, please add a comma between the categories :).</small>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Overview</label>
                <div class="col-sm-10">
                  <textarea class="form-control" matInput formControlName="overview"></textarea>
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['overview'].hasError('required') && createbook.controls['overview'].touched">
                    Overview is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Library</label>
                <div class="col-sm-10">
                  <select class="form-control" matInput formControlName="library_Id">
                    <option value="0" disabled selected>Please choose one</option>
                    <option *ngFor="let library of book.libraries" [ngValue]="library.id">{{library.library_Name}}
                    </option>
                  </select>
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="createbook.controls['library_Id'].hasError('required') && createbook.controls['library_Id'].touched && (createbook.controls['library_Id'].value == 0)">
                    Library is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <div class="col-sm-9">
                  <input type="file" #file placeholder="Choose Image" formControlName="image"
                    (change)="uploadFile(file.files)" style="display:none;">
                  <button class="btn btn-primary" (click)="file.click()">Upload Image</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <div class="col-sm-12">
                  <button class="btn btn-success col-sm-12" [disabled]="!createbook.valid"
                    (click)="submit()">Submit</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #deleteBook>
  <div class="col-12 ">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Are you sure you want to delete this item?</h4>
        <div class="row">
          <div class="col-md-9 ">
            <button mat-button mat-dialog-close class="btn btn-primary">Close</button>
            <button mat-button mat-dialog-close class="btn btn-danger" style="float: right;" (click)="delete()">Delete</button>
        </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #updateBook>
  <div class="col-12 dialog">
    <div class="card">
      <div class="card-body">
        <h4 class="card-title">Update Book <button mat-button mat-dialog-close class="btn"
            style="color: red; float: right; font-size: 25px;">X</button></h4>
        <form class="form-sample" [formGroup]="updatebook">
          <p class="card-description"> Book info </p>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Book Name</label>
                <div class="col-sm-8">
                  <input type="text " class="form-control" [(ngModel)]="selectedBook.book_Name" matInput formControlName="book_Name" placeholder="Book name">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['book_Name'].hasError('required') && updatebook.controls['book_Name'].touched">
                    Book name is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Author Name</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" [(ngModel)]="selectedBook.author" matInput formControlName="author" placeholder="author name">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['author'].hasError('required') && updatebook.controls['author'].touched">
                    Author name is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Price</label>
                <div class="col-sm-8">
                  <input type="number" min="1" class="form-control" [(ngModel)]="selectedBook.price" matInput formControlName="price" value="1">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['price'].hasError('required') && updatebook.controls['price'].touched">
                    Price is <strong class="text-danger">required</strong>
                  </mat-error>
                  <mat-error class="text-danger" *ngIf="updatebook.controls['price'].hasError('min') ">
                    Price must be more than 0
                  </mat-error>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group row">
                <label class="col-sm-4 col-form-label">Quantity</label>
                <div class="col-sm-8">
                  <input type="number" min="1" class="form-control" [(ngModel)]="selectedBook.quantity" matInput formControlName="quantity" value="1">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['quantity'].hasError('required') && updatebook.controls['quantity'].touched">
                    Quantity is <strong class="text-danger">required</strong>
                  </mat-error>
                  <mat-error class="text-danger" *ngIf="updatebook.controls['quantity'].hasError('min') ">
                    Quantity must be more than 0
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Categoryies</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" [(ngModel)]="selectedBook.category" matInput formControlName="category">
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['category'].hasError('required') && updatebook.controls['category'].touched">
                    Category is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
                <small>*For more than one category, please add a comma between the categories :).</small>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Overview</label>
                <div class="col-sm-10">
                  <textarea class="form-control" [(ngModel)]="selectedBook.overview"  matInput formControlName="overview"></textarea>
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['overview'].hasError('required') && updatebook.controls['overview'].touched">
                    Overview is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">Library</label>
                <div class="col-sm-10">
                  <select class="form-control" matInput formControlName="library_Id">
                    <option value="0" disabled>Please choose one</option>
                    <option *ngFor="let library of book.libraries" [selected]="library.id==selectedBook" [ngValue]="library.id">{{library.library_Name}}
                    </option>
                  </select>
                  <br>
                  <mat-error class="text-danger"
                    *ngIf="updatebook.controls['library_Id'].hasError('required') && updatebook.controls['library_Id'].touched && (updatebook.controls['library_Id'].value == 0)">
                    Library is <strong class="text-danger">required</strong>
                  </mat-error>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <div class="col-sm-9">
                  <input type="file" #file placeholder="Choose Image" formControlName="image"
                    (change)="uploadFile(file.files)" style="display:none;">
                  <button class="btn btn-primary" (click)="file.click()">Upload Image</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group row">
                <div class="col-sm-12">
                  <button class="btn btn-success col-sm-12" [disabled]="!updatebook.valid"
                    (click)="update()">Update</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-template>
